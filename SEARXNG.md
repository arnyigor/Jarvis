# SearXNG & Docker: Руководство администратора
Это руководство описывает типовые задачи управления локальным мета-поисковым движком SearXNG, развернутым через Docker Compose. Используйте этот документ для обслуживания, обновления и диагностики вашего сервиса.

## 1. Состояние системы
Ваш сервис настроен в режиме **"Production"** с политикой перезапуска `restart: always`. Это означает:
*   Сервис стартует автоматически вместе с запуском Docker Desktop.
*   При падении процесса он перезапустится сам.
*   Порт доступа: `8080`.

![Docker Architecture for SearXNG Service]
## 2. Повседневное управление
Все команды выполняются из папки с файлом `docker-compose.yml` (например, `C:\my-searxng`).

### 2.1. Проверка статуса
Чтобы убедиться, что сервер жив и узнать время его аптайма:

```bash
docker ps
```
**Интерпретация вывода:**
*   **STATUS `Up X hours`**: Всё отлично, работает X часов.
*   **STATUS `Restarting (1) ...`**: Проблема, контейнер в цикле перезагрузки (см. раздел "Диагностика").
*   **Пустой вывод**: Контейнер остановлен.

### 2.2. Остановка и запуск (Ручной режим)
Если нужно освободить ресурсы (ОЗУ/CPU) пока вы не работаете над Jarvis:

```bash
# Мягкая остановка (сохраняет состояние)
docker stop searxng

# Запуск обратно
docker start searxng
```

### 2.3. Полная перезагрузка
Необходима, если сервис завис или ведет себя странно:
```bash
docker restart searxng
```

## 3. Управление конфигурацией
Все настройки лежат в файле `searxng/settings.yml`. Изменения **не применяются мгновенно**.

**Алгоритм изменения настроек:**
1.  Откройте `searxng/settings.yml` в текстовом редакторе.
2.  Внесите правки (например, отключите Google или смените тему).
3.  Примените изменения командой:
    ```bash
    docker restart searxng
    ```

### Полезные настройки для RAG/Jarvis
| Параметр | Значение | Описание |
| :--- | :--- | :--- |
| `server.limiter` | `false` | **Критично.** Отключает троттлинг (бан) вашего скрипта за частые запросы к локальному API [1]. |
| `search.formats` | `- json` | Разрешает получение чистых данных для LLM. |
| `search.safe_search` | `0` | Отключает фильтрацию контента (чтобы LLM не получал урезанную информацию). |

## 4. Обновление (Update)
SearXNG активно развивается. Если поисковики (Google/Bing) изменили верстку, старая версия SearXNG перестанет работать. Обновляйте контейнер раз в 1-2 месяца.

**Процедура обновления (Zero Downtime практически невозможен, займет 1-2 минуты):**

```bash
# 1. Скачать последнюю версию образа
docker compose pull

# 2. Пересоздать контейнер на новом образе
docker compose up -d
```
*Команда `up -d` умная: она увидит, что образ обновился, удалит старый контейнер и создаст новый, сохранив ваши настройки.*

## 5. Диагностика и Логи
Если `httpx.get` в Python выдает ошибку или сайт не открывается.

### 5.1. Чтение логов в реальном времени
Смотрим, что происходит внутри прямо сейчас (нажмите `Ctrl+C` для выхода):
```bash
docker logs -f searxng
```

### 5.2. Типичные ошибки в логах
*   **"Redis connection error"**: Проблема с внутренней базой. Решение: `docker restart searxng`.
*   **"Banned by Google"**: Слишком частые запросы к конкретному движку. SearXNG сам временно отключит Google и переключится на Bing/DDG. Ничего делать не надо, бан временный.
*   **"Secret key not defined"**: Вы стерли `secret_key` из `settings.yml`. Верните его обратно.

## 6. Удаление (Uninstall)
Если вы хотите полностью удалить SearXNG с компьютера:

```bash
# 1. Остановить и удалить контейнеры и сеть
docker compose down

# 2. Удалить скачанный образ (освободит ~300 МБ)
docker rmi searxng/searxng:latest

# 3. (Опционально) Удалить папку с конфигами
# Удалите папку my-searxng вручную через проводник
```

***

### Чек-лист для интеграции в Python
При написании кода для Jarvis используйте эти параметры для максимальной надежности:

*   **URL:** `http://localhost:8080/search`
*   **Method:** `GET`
*   **Timeout:** Ставьте не менее **10-15 секунд**. Мета-поиск занимает время (агрегация 5-10 источников).
*   **Retry:** Используйте библиотеку с ретраями (например, `tenacity`), так как сетевые сбои при парсинге неизбежны.

[1](https://docs.searxng.org/admin/installation-searxng.html)